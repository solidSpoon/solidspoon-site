<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Blog | solidSpoon&#x27;s site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://solidspoon.xyz/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://solidspoon.xyz/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://solidspoon.xyz/blog/page/2"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="Blog | solidSpoon&#x27;s site"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/logoo.svg"><link data-rh="true" rel="canonical" href="https://solidspoon.xyz/blog/page/2"><link data-rh="true" rel="alternate" href="https://solidspoon.xyz/blog/page/2" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://solidspoon.xyz/blog/page/2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="solidSpoon&#39;s site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="solidSpoon&#39;s site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.93b573f6.css">
<script src="/assets/js/runtime~main.f576c724.js" defer="defer"></script>
<script src="/assets/js/main.4169ff93.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logoo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logoo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Hide</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/app/dash-player">DashPlayer</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_brwN flex flex-col" aria-label="最近博文导航"><div class="sidebarItemTitle_r4Q1 margin-bottom--md">All posts</div><div class="w-full flex-1 overflow-y-auto thin-scrollbar"><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/inventory-lock-master">锁库大师</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/spring-transaction-propagation-characteristics">Spring 事务传播特性</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/exploring-mongodb">MongoDB 初探</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/clash-for-windows-tap-mode-cannot-connect-to-network-normally">ClashForWindows tap 模式无法正常连接网络</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/java-functional-programming-explained">Java 函数式编程详解</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/custom-class-loader-loads-encrypted-class-file">自定义 ClassLoader 加载一个加密 class 文件</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/step-by-step-guide-to-reading-bytecode-of-a-java-file">手把手教你读一个 Java 文件的字节码</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/getting-started-with-jshell">初识 JShell</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/docker-diagnostic-tool-busybox">Docker 诊断神器 BusyBox</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/docker-network-configuration">Docker 网络设置</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/mysql-8-0-building-semi-synchronous-replication">MySQL 8.0 搭建半同步复制</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/win10-mysql-5-7-docker-building-master-slave-replication">Win10 - MySQL 5.7 - Docker 搭建主从复制</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/win10-mysql-8-0-docker-building-master-slave-replication">Win10 - MySQL 8.0 - Docker 搭建主从复制</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/win10-mysql-8-zip-version-building-gtid-based-master-slave-replication">Win10 - MySQL 8 Zip 版 - 搭建基于 GTID 的主从复制</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/win10-mysql-8-zip-version-building-master-slave-replication">Win10 - MySQL 8 Zip 版 - 搭建主从复制</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/an-essay">一篇散文</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/article-formatting-guide">文章排版指南</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/building-a-simple-and-user-friendly-note-taking-system">搭建简单好用的笔记系统</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/git-is-a-purely-functional-data-structure">Git 是纯函数式数据结构</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/how-to-visually-edit-web-page-elements">怎么直观地给网页「P 图」</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/matching-multiples-of-3-with-regular-expressions">如何用正则表达式匹配 3 的倍数</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/multi-cursor-feature-in-vs-code">VsCode 多光标特性</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/reflections-on-movie-the-island">一出好戏有感</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/removing-or-modifying-occupied-files-in-windows">删除或修改 Windows 中被占用的文件</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/several-methods-to-view-docker-ip">查看 Docker IP 的几种方法</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/the-intriguing-three-way-handshake-and-four-way-farewell-in-tcp-1">有趣的三次握手与四次挥手 1</a></li></ul></div></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="说明：搭建半同步复制需要预先有基本的主从复制环境，具体可以看我之前的文章："><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/mysql-8-0-building-semi-synchronous-replication">MySQL 8.0 搭建半同步复制</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-17T00:00:00.000Z" itemprop="datePublished">2021年2月17日</time> · <!-- -->阅读需 4 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>说明：搭建半同步复制需要预先有基本的主从复制环境，具体可以看我之前的文章：</p>
<blockquote>
<p><a href="https://github.com/solidSpoon/solidSpoon.github.io/wiki" target="_blank" rel="noopener noreferrer">https://github.com/solidSpoon/solidSpoon.github.io/wiki</a></p>
</blockquote>
<p>半同步超时的时候，会自动降为异步工作。当Slave开启半同步后，或者当主从之间网络延迟恢复正常的时候，半同步复制会自动从异步复制又转为半同步复制，还是相当智能的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="master-配置">Master 配置<a href="#master-配置" class="hash-link" aria-label="Master 配置的直接链接" title="Master 配置的直接链接">​</a></h2>
<p>安装半同步模块并启动</p>
<p>这里 Windows 版本有个坑</p>
<p>对于 Linux 来说：此模块位置在 <code>/usr/local/mysql/lib/plugin/semisync_master.so</code>
对于 Windows Zip 版本来说：插件的位置本来在 <code>..\lib\semisync_master.dll</code> ，但是 MySQL 默认的位置是 <code>\bin\lib\plugin\semisync_master.so</code> </p>
<p>要解决这个问题，我们把 lib 目录复制一份过去就好了。</p>
<p>也可以在配置文件中指定插件目录：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugin_dir=/path/to/plugin/directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果 <a href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/server-system-variables.html#sysvar_plugin_dir" target="_blank" rel="noopener noreferrer">plugin_dir</a> 的值是相对路径名，则将其视为相对于 MySQL 基本目录（ <a href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/server-system-variables.html#sysvar_basedir" target="_blank" rel="noopener noreferrer">basedir</a> 系统变量的值）。</p>
<p>下面是安装模块的命令：</p>
<p>Linux：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; install plugin rpl_semi_sync_master soname &#x27;semisync_master.so&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Windows：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; install plugin rpl_semi_sync_master soname &#x27;semisync_master.dll&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安装完后：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show global variables like &#x27;%semi%&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show global variables like &#x27;%semi%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name                             | Value      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_enabled              | OFF        | -&gt; 是否启用半同步协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_timeout              | 10000      | -&gt; 链接 Slave 超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_trace_level          | 32         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_for_slave_count | 1          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_point           | AFTER_SYNC | -&gt; MySQL 5.7 之后默认值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 rows in set, 1 warning (0.02 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; set global rpl_semi_sync_master_enabled = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; set global rpl_semi_sync_master_timeout = 2000;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>安装后启动和定制主从连接错误的超时时间默认是 10s 可改为 2s，一旦有一次超时自动降级为异步。（以上内容要想永久有效需要写到配置文件中）</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@localhost ~]# cat /etc/my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpl_semi_sync_master_enabled = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpl_semi_sync_master_timeout = 2000;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="slave-配置">Slave 配置<a href="#slave-配置" class="hash-link" aria-label="Slave 配置的直接链接" title="Slave 配置的直接链接">​</a></h2>
<p>1）安装半同步模块并启动</p>
<p>Linux：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; install plugin rpl_semi_sync_slave soname &#x27;semisync_slave.so&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>WIndows：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; install plugin rpl_semi_sync_slave soname &#x27;semisync_slave.dll&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同样，如果报错就把插件目录移动一下</p>
<p><code>lib</code> -&gt; <code>bin\lib</code></p>
<p>接着执行</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; set global rpl_semi_sync_slave_enabled = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show global variables like &#x27;%semi%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name                             | Value      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_enabled              | ON         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_timeout              | 10000      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_trace_level          | 32         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_for_slave_count | 1          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_no_slave        | ON         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_master_wait_point           | AFTER_SYNC |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_slave_enabled               | ON         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| rpl_semi_sync_slave_trace_level           | 32         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-------------------------------------------+------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 rows in set, 1 warning (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2）从节点需要重新连接主服务器半同步才会生效</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; stop slave io_thread;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; start slave io_thread;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PS：如果想卸载异步模块就使用 uninstall 即可。</p>
<p>Master 上查看是否启用了半同步</p>
<p><img loading="lazy" src="https://ced-md-picture.oss-cn-beijing.aliyuncs.com/img/20210203214530.png" alt="" class="img_ev3q"></p>
<p>现在半同步已经正常工作了，主要看 <code>Rpl_semi_sync_master_clients</code> 是否不为 0，<code>Rpl_semi_sync_master_status</code> 是否为 ON。如果 <code>Rpl_semi_sync_master_status</code> 为 OFF，说明出现了网络延迟或 Slave IO 线程延迟。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="验证">验证<a href="#验证" class="hash-link" aria-label="验证的直接链接" title="验证的直接链接">​</a></h2>
<p>半同步超时，是否会自动降为异步工作</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slave">Slave<a href="#slave" class="hash-link" aria-label="Slave的直接链接" title="Slave的直接链接">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关闭半同步">关闭半同步;<a href="#关闭半同步" class="hash-link" aria-label="关闭半同步;的直接链接" title="关闭半同步;的直接链接">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; set global rpl_semi_sync_slave_enabled = 0 ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; stop slave io_thread;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; start slave io_thread;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="master">Master<a href="#master" class="hash-link" aria-label="Master的直接链接" title="Master的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; insert into t1(id) values(5),(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 rows affected (10.06 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; insert into t1(id) values(6),(7);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 rows affected (0.03 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="搭建环境：Windows 10 Docker Desktop WSL 2 based engine"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/win10-mysql-5-7-docker-building-master-slave-replication">Win10 - MySQL 5.7 - Docker 搭建主从复制</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-17T00:00:00.000Z" itemprop="datePublished">2021年2月17日</time> · <!-- -->阅读需 3 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote>
<p>搭建环境：Windows 10 Docker Desktop WSL 2 based engine</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建">创建<a href="#创建" class="hash-link" aria-label="创建的直接链接" title="创建的直接链接">​</a></h2>
<p>首先创建两个数据库，一个作为主库，另一个作为从库</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写-docker-conpose-文件">编写 docker-conpose 文件<a href="#编写-docker-conpose-文件" class="hash-link" aria-label="编写 docker-conpose 文件的直接链接" title="编写 docker-conpose 文件的直接链接">​</a></h3>
<p>首先安装 docker，docker-compose
一般安装了 docker 都会安装 docker-compose，可以使用 <code>docker-compose -verison</code> 查看是否安装</p>
<p><code>docker pull mysql:5.7</code> 拉取 mysql5.7 镜像</p>
<p>编写 docker-compose 文件「docker-compose.yaml」</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">byfn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                       </span><span class="token comment" style="color:#999988;font-style:italic">#配置byfn网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                     </span><span class="token comment" style="color:#999988;font-style:italic">#配置master服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mysql:5.7&#x27;</span><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">#使用刚才pull下来的镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master              </span><span class="token comment" style="color:#999988;font-style:italic">#容器起名 mysql-master</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123           </span><span class="token comment" style="color:#999988;font-style:italic">#配置root的密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3316:3306&#x27;</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic">#配置端口映射</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./master/my.cnf:/etc/mysql/my.cnf&quot;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">#配置my.cnf文件挂载，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> byfn                                  </span><span class="token comment" style="color:#999988;font-style:italic">#配置当前servie挂载的网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">slave</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                      </span><span class="token comment" style="color:#999988;font-style:italic">#配置slave服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mysql:5.7&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3326:3306&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./slave/my.cnf:/etc/mysql/my.cnf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> byfn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写-cnf-文件">编写 cnf 文件<a href="#编写-cnf-文件" class="hash-link" aria-label="编写 cnf 文件的直接链接" title="编写 cnf 文件的直接链接">​</a></h3>
<p>在 <code>docker-compose.yaml</code> 当前目录下，建立两个文件夹，master 和 slave，里面分别写入文件「my.cnf」</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mater/my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin=/var/lib/mysql/mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slave/my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">id=2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分别保存后退出</p>
<p>然后在当前 docker-compose.yaml 文件目录下执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compse.yaml up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时两个数据库创建成功</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="master">Master<a href="#master" class="hash-link" aria-label="Master的直接链接" title="Master的直接链接">​</a></h3>
<p>启动之后进入 master 容器</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it mysql-master /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -padmin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">进入 mysql 终端之后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create user &#x27;repl&#x27;@&#x27;%&#x27; identified by &#x27;admin123&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;repl&#x27;@&#x27;%&#x27;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后的 <code>show master status;</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql-bin.000003 |      767 |              |                  |                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要记住 File 名字，和 Position 偏移位置</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slave">Slave<a href="#slave" class="hash-link" aria-label="Slave的直接链接" title="Slave的直接链接">​</a></h3>
<p>另起一个终端进入 slave 容器</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it mysql-slave /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -padmin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">进入 mysql 终端之后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; CHANGE MASTER TO MASTER_HOST=&#x27;mysql-master&#x27;, MASTER_PORT=3306,  MASTER_USER=&#x27;repl&#x27;, MASTER_PASSWORD=&#x27;admin123&#x27;, MASTER_LOG_FILE=&#x27;mysql-bin.000003&#x27;, MASTER_LOG_POS=767;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; start slave;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里两个参数 MASTER_LOG_FILE 和 MASTER_LOG_POS 就是前面 master 上最后查询出来的；</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show slave status\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               Slave_IO_State: Waiting for master to send event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_Host: mysql-master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_User: repl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_Port: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Connect_Retry: 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Master_Log_File: mysql-bin.000003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Read_Master_Log_Pos: 1116</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               Relay_Log_File: eefecaed2964-relay-bin.000002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Relay_Log_Pos: 320</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Relay_Master_Log_File: mysql-bin.000003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Slave_IO_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Slave_SQL_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Replicate_Do_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Replicate_Ignore_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           Replicate_Do_Table:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查询 slave 的状态，看到 Slave_IO_Running 和 Slave_SQL_Running 都是 yes 即为同步成功</p>
<p>可以登录 master 上创建数据库，表，然后在 slave 这边查看数据是否同步</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="搭建环境：Windows 10 Docker Desktop WSL 2 based engine"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/win10-mysql-8-0-docker-building-master-slave-replication">Win10 - MySQL 8.0 - Docker 搭建主从复制</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-17T00:00:00.000Z" itemprop="datePublished">2021年2月17日</time> · <!-- -->阅读需 4 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote>
<p>搭建环境：Windows 10 Docker Desktop WSL 2 based engine</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建">创建<a href="#创建" class="hash-link" aria-label="创建的直接链接" title="创建的直接链接">​</a></h2>
<p>首先创建两个数据库，一个作为主库，另一个作为从库</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写-docker-conpose-文件">编写 docker-conpose 文件<a href="#编写-docker-conpose-文件" class="hash-link" aria-label="编写 docker-conpose 文件的直接链接" title="编写 docker-conpose 文件的直接链接">​</a></h3>
<p>一般安装了 docker 都会安装 docker-compose，可以使用 <code>docker-compose -verison</code> 查看是否安装</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  ~ docker-compose -verison</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose version 1.27.4, build 40524192</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>新建一个文件夹「mysqlms」用于存放本次搭建的文件
在 「mysqlms」 文件夹新建 dokcer-compose 文件，文件名为 「docker-compose.yaml」</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">byfn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                       </span><span class="token comment" style="color:#999988;font-style:italic">#配置byfn网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                     </span><span class="token comment" style="color:#999988;font-style:italic">#配置master服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mysql:latest&#x27;</span><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">#使用刚才pull下来的镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">master              </span><span class="token comment" style="color:#999988;font-style:italic">#容器起名 mysql-master</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123           </span><span class="token comment" style="color:#999988;font-style:italic">#配置root的密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3316:3306&#x27;</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic">#配置端口映射</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./master/my.cnf:/etc/mysql/my.cnf&quot;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">#配置my.cnf文件挂载，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./master/mysql-files:/var/lib/mysql-files&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#MySQL 8.0 不加这一行会报错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> byfn                                  </span><span class="token comment" style="color:#999988;font-style:italic">#配置当前servie挂载的网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">slave</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                                      </span><span class="token comment" style="color:#999988;font-style:italic">#配置slave服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mysql:latest&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admin123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3326:3306&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./slave/my.cnf:/etc/mysql/my.cnf&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./master/mysql-files:/var/lib/mysql-files&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#MySQL 8.0 不加这一行会报错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> byfn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>- &quot;./master/mysql-files:/var/lib/mysql-files&quot;</code> 这一行的目的详见下面链接</p>
<blockquote>
<p><a href="https://github.com/docker-library/mysql/issues/541" target="_blank" rel="noopener noreferrer">https://github.com/docker-library/mysql/issues/541</a></p>
</blockquote>
<p>如果想明确指定 MySQL 版本，如： <code>image: &#x27;mysql:8&#x27;</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写-cnf-文件">编写 cnf 文件<a href="#编写-cnf-文件" class="hash-link" aria-label="编写 cnf 文件的直接链接" title="编写 cnf 文件的直接链接">​</a></h3>
<p>在 「mysqlms」新建两个文件夹 「master」 和 「slave」，在其中分别写入文件「my.cnf」</p>
<ul>
<li>mysqlms/master/my.cnf 内容如下：</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-bin=/var/lib/mysql/mysql-bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>mysqlms/slave/my.cnf 内容如下</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[mysqld]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在「mysqlms」目录下执行如下命令</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f docker-compose.yaml up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时两个主从数据库创建成功</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="master">Master<a href="#master" class="hash-link" aria-label="Master的直接链接" title="Master的直接链接">​</a></h3>
<p>启动之后进入 master 容器</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it mysql-master /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -padmin123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时进入了 MySql 终端，创建用于主从复制的用户</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create user &#x27;repl&#x27;@&#x27;%&#x27; identified with &#x27;mysql_native_password&#x27; by &#x27;admin123&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;repl&#x27;@&#x27;%&#x27;; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里有一个需要注意的地方，应该是 MySQL 5.0 与 MySQL 8.0 的一个验证身份的比较大的区别：</p>
<p>MySql 8.0 默认指定使用需要 SSL 的身份验证插件 「caching_sha2_password」，意味着我们从库必须使用安全链接来连接到主库才可以，否则从库链接的时候会报错，错误代码为 2061，因此这里选择绕过这个插件，改为使用「mysql_native_password」来验 证。有机会可以尝试以下使用安全连接。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show master status;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql-bin.000003 |      767 |              |                  |                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要记住 File 名字，和 Position 偏移位置</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="slave">Slave<a href="#slave" class="hash-link" aria-label="Slave的直接链接" title="Slave的直接链接">​</a></h3>
<p>在另一个终端进入 slave  容器</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it mysql-slave /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -padmin123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入 MySQL 终端之后</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; CHANGE MASTER TO MASTER_HOST=&#x27;mysql-master&#x27;, MASTER_PORT=3306,  MASTER_USER=&#x27;repl&#x27;, MASTER_PASSWORD=&#x27;admin123&#x27;, MASTER_LOG_FILE=&#x27;mysql-bin.000003&#x27;, MASTER_LOG_POS=767;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; start slave;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里两个参数 <code>MASTER_LOG_FILE</code> 和 <code>MASTER_LOG_POS</code> 就是前面 master 上最后查询出来的</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show slave status\G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               Slave_IO_State: Waiting for master to send event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_Host: mysql-master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_User: repl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  Master_Port: 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Connect_Retry: 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Master_Log_File: mysql-bin.000003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Read_Master_Log_Pos: 1116</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               Relay_Log_File: eefecaed2964-relay-bin.000002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Relay_Log_Pos: 320</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Relay_Master_Log_File: mysql-bin.000003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Slave_IO_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Slave_SQL_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Replicate_Do_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Replicate_Ignore_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           Replicate_Do_Table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以从中看到一些信息：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">             Slave_IO_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Slave_SQL_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可见主从配置成功</p>
<hr>
<p>参考链接</p>
<ul>
<li><a href="https://blog.csdn.net/wawa8899/article/details/86689618" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/wawa8899/article/details/86689618</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-howto-repuser.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/8.0/en/replication-howto-repuser.html</a></li>
<li><a href="https://github.com/docker-library/mysql/issues/541" target="_blank" rel="noopener noreferrer">https://github.com/docker-library/mysql/issues/541</a></li>
<li><a href="https://blog.csdn.net/wangxiaotongfan/article/details/81870258" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/wangxiaotongfan/article/details/81870258</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="配置环境：Windows 10 - MySQL 压缩版"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/win10-mysql-8-zip-version-building-gtid-based-master-slave-replication">Win10 - MySQL 8 Zip 版 - 搭建基于 GTID 的主从复制</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-17T00:00:00.000Z" itemprop="datePublished">2021年2月17日</time> · <!-- -->阅读需 5 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote>
<p>配置环境：Windows 10 - MySQL 压缩版</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="前言的直接链接" title="前言的直接链接">​</a></h2>
<p>GTID 是干嘛的？</p>
<blockquote>
<p>GTID (Global Transaction IDentifier) 是全局事务标识。它具有全局唯一性，一个事务对应一个GTID。唯一性不仅限于主服务器，GTID在所有的从服务器上也是唯一的。一个GTID在一个服务器上只执行一次，从而避免重复执行导致数据混乱或主从不一致。</p>
<p>在传统的复制里面，当发生故障需要主从切换时，服务器需要找到binlog和pos点，然后将其设定为新的主节点开启复制。相对来说比较麻烦，也容易出错。在MySQL 5.6里面，MySQL会通过内部机制自动匹配GTID断点，不再寻找binlog和pos点。我们只需要知道主节点的ip，端口，以及账号密码就可以自动复制。
<a href="http://mysql.taobao.org/monthly/2020/05/09/" target="_blank" rel="noopener noreferrer">http://mysql.taobao.org/monthly/2020/05/09/</a></p>
</blockquote>
<p>在传统的主从复制中，我们需要在从库中指定主库的 Log 文件与 Position ，在基于 DTID 的主从复制中，不需要这一步骤。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备两个-mysql-服务实例">准备两个 MySQL 服务实例<a href="#准备两个-mysql-服务实例" class="hash-link" aria-label="准备两个 MySQL 服务实例的直接链接" title="准备两个 MySQL 服务实例的直接链接">​</a></h2>
<p>8.0 压缩版下载地址：</p>
<blockquote>
<p><a href="https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.16-winx64.zip" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.16-winx64.zip</a></p>
</blockquote>
<p>解压后再复制一份，假设命名为 <code>mysql-8.0.16-winx64</code> 和 <code>mysql-8.0.16-winx64-2</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="修改主-mysql-8的-myini">修改主 MySQL-8的 <code>my.ini</code><a href="#修改主-mysql-8的-myini" class="hash-link" aria-label="修改主-mysql-8的-myini的直接链接" title="修改主-mysql-8的-myini的直接链接">​</a></h2>
<p>在 <code>mysql-8.0.16-winx64</code> 目录下添加 my.ini 文件，内容如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basedir = ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir = ./data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_id = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gtid_mode=ON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enforce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gtid</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consistency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql_mode=NO_ENGINE_SUBSTITUTION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">STRICT_TRANS_TABLES </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_bin=mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format=Row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="修改从-mysql-8的-myini">修改从 MySQL-8的 <code>my.ini</code><a href="#修改从-mysql-8的-myini" class="hash-link" aria-label="修改从-mysql-8的-myini的直接链接" title="修改从-mysql-8的-myini的直接链接">​</a></h2>
<p>在从 <code>mysql-8.0.16-winx64-2</code> 目录下添加 my.ini 文件，内容如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basedir = ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir = ./data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 3316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_id = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gtid_mode=ON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enforce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gtid</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consistency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql_mode=NO_ENGINE_SUBSTITUTION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">STRICT_TRANS_TABLES </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_bin=mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format=Row</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化和启动数据库">初始化和启动数据库<a href="#初始化和启动数据库" class="hash-link" aria-label="初始化和启动数据库的直接链接" title="初始化和启动数据库的直接链接">​</a></h2>
<p>空数据库需要初始化，分别在两个数据库的 <code>\bin</code> 目录下执行 <code>mysqld --initialize-insecure</code> 进行初始化。</p>
<p>分别启动主和从，在两个数据库的 <code>\bin</code> 目录下直接执行 <code>mysqld</code> 或 <code>start mysqld</code> 命令即可。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置主节点">配置主节点<a href="#配置主节  点" class="hash-link" aria-label="配置主节点的直接链接" title="配置主节点的直接链接">​</a></h2>
<p>用 <code>mysql</code> 命令登录到主节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -P3306</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入后执行下面命令</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; CREATE USER &#x27;repl&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.11 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#x27;repl&#x27;@&#x27;%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.12 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.10 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建数据库：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create schema db;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主节点证书文件">主节点证书文件<a href="#主节点证书文件" class="hash-link" aria-label="主节点证书文件的直接链接" title="主节点证书文件的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; SHOW GLOBAL VARIABLES LIKE &#x27;caching_sha2_password_public_key_path&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name                         | Value          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| caching_sha2_password_public_key_path | public_key.pem |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个文件在初始化后位于 <code>\bin\data</code> 下</p>
<p>因为 MySQL 8 默认是用 <code>caching_sha2_password</code> 做认证插件，这点与 MySQL 5 不同：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error connecting to master &#x27;repl@localhost:3306&#x27; - retry-time: 60 retries: 18 message: Authentication plugin &#x27;caching_sha2_password&#x27; reported error: Authentication requires secure connection.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个文件就是基于默认设置 <code>caching_sha2_password</code> 下的通讯公钥文件。默认情况服务器不会给客户端发送，所以需要拷贝到从节点的目录下。</p>
<p> 如果不想拷贝的话 ：</p>
<p>MySQL 8.0 的版本要在<strong>从数据库</strong>初始设置（CHANGE MASTER TO）加：</p>
<p><code>MASTER_PUBLIC_KEY_PATH = &#x27;key_file_name&#x27;</code></p>
<p>或者</p>
<p><code>GET_MASTER_PUBLIC_KEY = {0|1}</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置从节点">配置从节点<a href="#配置从节点" class="hash-link" aria-label="配置从节点的直接链接" title="配置从节点的直接链接">​</a></h2>
<p>把刚才的 <code>public_key.pem</code> 文件改名为 <code>master_public_key.pem</code> 然后拷贝到从服务器的 <code>\bin\data</code> 文件夹中，这个文件夹在用上面的命令初始化之后才有。</p>
<p><code>mysql</code> 命令登录到从节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -P3316</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CHANGE MASTER TO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_HOST=&#x27;localhost&#x27;,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PORT = 3306,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_USER=&#x27;repl&#x27;,      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PASSWORD=&#x27;123456&#x27;,   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PUBLIC_KEY_PATH=&#x27;master_public_key.pem&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_AUTO_POSITION = 1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里有个问题，MySQL 8 下面不需要创建 db 。否则会报错说已经存在 db 。
--创建数据库：create schema db;--</p>
<p>直接开始执行同步
<code>start/stop slave;</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="验证操作">验证操作<a href="#验证操作" class="hash-link" aria-label="验证操作的直接链接" title="验证操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主库">主库<a href="#主库" class="hash-link" aria-label="主库的直接链接" title="主库的直接链接">​</a></h3>
<p>在主库执行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Database changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create table t1(id int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.17 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; insert into t1(id) values(1),(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 rows affected (0.04 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="从库">从库<a href="#从库" class="hash-link" aria-label="从库的直接链接" title="从库的直接链接">​</a></h3>
<p>在从库查看数据同步情况</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Database changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show tables;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Tables_in_db |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| t1           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select * from t1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看命令">查看命令<a href="#查看命令" class="hash-link" aria-label="查看命令的直接链接" title="查看命令的直接链接">​</a></h2>
<p>可以通过 <code>show master status\G</code>，<code>show slave status\G</code> 查看状态，或定位一些问题</p>
<p>可以能改过 <code>stop slave;</code>  <code>start slave;</code> 来停止复制。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>  标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Win10 - MySQL 8 压缩版 - 主从复制"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/win10-mysql-8-zip-version-building-master-slave-replication">Win10 - MySQL 8 Zip 版 - 搭建主从复制</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-17T00:00:00.000Z" itemprop="datePublished">2021年2月17日</time> · <!-- -->阅读需 5 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="win10---mysql-8-压缩版---主从复制">Win10 - MySQL 8 压缩版 - 主从复制<a href="#win10---mysql-8-压缩版---主从复制" class="hash-link" aria-label="Win10 - MySQL 8 压缩版 - 主从复制的直接链接" title="Win10 - MySQL 8 压缩版 - 主从复制的直接链接">​</a></h2>
<blockquote>
<p>配置环境：Windows 10 - MySQL 压缩版</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="准备两个-mysql-服务实例">准备两个 MySQL   服务实例<a href="#准备两个-mysql-服务实例" class="hash-link" aria-label="准备两个 MySQL 服务实例的直接链接" title="准备两个 MySQL 服务实例的直接链接">​</a></h2>
<p>8.0 压缩版下载地址：</p>
<blockquote>
<p><a href="https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.16-winx64.zip" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.16-winx64.zip</a></p>
</blockquote>
<p>解压后再复制一份，假设命名为 <code>mysql-8.0.16-winx64</code> 和 <code>mysql-8.0.16-winx64-2</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="修改主-mysql-8的-myini">修改主 MySQL-8的 <code>my.ini</code><a href="#修改主-mysql-8的-myini" class="hash-link" aria-label="修改主-mysql-8的-myini的直接链接" title="修改主-mysql-8的-myini的直接链接">​</a></h2>
<p>在 <code>mysql-8.0.16-winx64</code> 目录下添加 my.ini 文件，内容如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basedir = ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir = ./data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_id = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql_mode=NO_ENGINE_SUBSTITUTION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">STRICT_TRANS_TABLES </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_bin=mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format=Row</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="修改从-mysql-8的-myini">修改从 MySQL-8的 <code>my.ini</code><a href="#修改从-mysql-8的-myini" class="hash-link" aria-label="修改从-mysql-8的-myini的直接链接" title="修改从-mysql-8的-myini的直接链接">​</a></h2>
<p>在从 <code>mysql-8.0.16-winx64-2</code> 目录下添加 my.ini 文件，内容如下：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basedir = ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir = ./data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port = 3316</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server_id = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql_mode=NO_ENGINE_SUBSTITUTION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">STRICT_TRANS_TABLES </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_bin=mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format=Row</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化和启动数据库">初始化和启动数据库<a href="#初始化和启动数据库" class="hash-link" aria-label="初始化和启动数据库的直接链接" title="初始化和启动数据库的直接链接">​</a></h2>
<p>空数据库需要初始化，分别在两个数据库的 <code>\bin</code> 目录下执行 <code>mysqld --initialize-insecure</code> 进行初始化。</p>
<p>分别启动主和从，在两个数据库的 <code>\bin</code> 目录下直接执行 <code>mysqld</code> 或 <code>start mysqld</code> 命令即可。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置主节点">配置主节点<a href="#配置主节点" class="hash-link" aria-label="配置主节点的直接链接" title="配置主节点的直接链接">​</a></h2>
<p>用 <code>mysql</code> 命令登录到主节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -P3306</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入后执行下面命令</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; CREATE USER &#x27;repl&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.11 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#x27;repl&#x27;@&#x27;%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.12 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; flush privileges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.10 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql-bin.000003 |      305 |              |                  |                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建数据库：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create schema db;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主节点证书文件">主节点证书文件<a href="#主节点证书文件" class="hash-link" aria-label="主节点证书文件的直接链接" title="主节点证书文件的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; SHOW GLOBAL VARIABLES LIKE &#x27;caching_sha2_password_public_key_path&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Variable_name                         | Value          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| caching_sha2_password_public_key_path | public_key.pem |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---------------------------------------+----------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个文件在初始化之后位于 <code>\bin\data</code> 下</p>
<p>因为 MySQL 8 默认是用 <code>caching_sha2_password</code> 做认证插件，这点与 MySQL 5 不同：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error connecting to master &#x27;repl@localhost:3306&#x27; - retry-time: 60 retries: 18 message: Authentication plugin &#x27;caching_sha2_password&#x27; reported error: Authentication requires secure connection.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个文件就是基于默认设置 <code>caching_sha2_password</code> 下的通讯公钥文件。默认情况服务器不会给客户端发送，所以需要拷贝到从节点的目录下。</p>
<p>如果不想拷贝的话 ：
MySQL 8.0 的版本要在<strong>从数据库</strong>初始设置（CHANGE MASTER TO）加：
<code>MASTER_PUBLIC_KEY_PATH = &#x27;key_file_name&#x27;</code>
或者
<code>GET_MASTER_PUBLIC_KEY = {0|1}</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置从节点">配置从节点<a href="#配置从节点" class="hash-link" aria-label="配置从节点的直接链接" title="配置从节点的直接链接">​</a></h2>
<p>把刚才的 <code>public_key.pem</code> 文件改名为 <code>master_public_key.pem</code> 然后拷贝到从服务器的 <code>\bin\data</code> 文件夹中，注意这个文件夹用上面的那个命令初始化之后才有。</p>
<p><code>mysql</code> 命令登录到从节点：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -uroot -P3316</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>还记得刚刚在主库查看的表格吗？</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| mysql-bin.000003 |      305 |              |                  |                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------------------+----------+--------------+------------------+-------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意以下的 MASTER_LOG_POS 需要改成这个表格上 Position 的数值</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CHANGE MASTER TO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_HOST=&#x27;localhost&#x27;,  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PORT = 3306,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_USER=&#x27;repl&#x27;,      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PASSWORD=&#x27;123456&#x27;,   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_LOG_FILE=&#x27;mysql-bin.000002&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_LOG_POS=855,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MASTER_PUBLIC_KEY_PATH=&#x27;master_public_key.pem&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //MASTER_AUTO_POSITION = 1;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里有个问题，MySQL 8 下面不需要创建 db 。否则会报错说已经存在 db 。
--创建数据库：create schema db;--</p>
<p>直接开始执行同步
<code>start/stop slave;</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="验证操作">验证操作<a href="#验证操作" class="hash-link" aria-label="验证操作的直接链接" title="验证操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主库">主库<a href="#主库" class="hash-link" aria-label="主库的直接链接" title="主库的直接链接">​</a></h3>
<p>在主库执行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Database changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; create table t1(id int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected (0.17 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; insert into t1(id) values(1),(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 rows affected (0.04 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="从库">从库<a href="#从库" class="hash-link" aria-label="从库的直接链接" title="从库的直接链接">​</a></h3>
<p>在从库查看数据同步情况</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; use db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Database changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show tables;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Tables_in_db |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| t1           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select * from t1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| id   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 rows in set (0.00 sec)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看命令">查看命令<a href="#查看命令" class="hash-link" aria-label="查看命令的直  接链接" title="查看命令的直接链接">​</a></h2>
<p>可以通过 <code>show master status\G</code>，<code>show slave status\G</code> 查看状态，或定位一些问题</p>
<p>可以能改过 <code>stop slave;</code>  <code>start slave;</code> 来停止复制。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="樱花烂漫时节，一身利落的轻装，踏着新发的嫩草，悠悠的散步。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/an-essay">一篇散文</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">2021年2月16日</time> · <!-- -->阅读需 2 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>樱花烂漫时节，一身利落的轻装，踏着新发的嫩草，悠悠的散步。</p>
<p>不知方向，不知目标，就只是静静的，慢慢的体会生活的美好，感悟生命的意义。听过一句话:人 生总是太匆忙。的确，忙忙碌碌中，我们忽视了很多生活的美好。</p>
<p>草长莺飞,万物轮回。时间一点一滴，带走了我们的年少时光，回顾往昔，我们拥有什么?我们曾经拥有什么?跌跌撞撞的小学生活，恍恍惚惚的初中时代，坎坎坷坷的高中炼狱，仿佛都成为了泡沫，在阳光下消弭。现在的现在，我们拥有的只有当下。</p>
<p>如今，最重要的是梦想，是志向。很多人为了这些行走匆忙，但忽视了周围的风景。春意盎然，阳光微煦，微风轻暖。此时，踏一席春色，享无边烂漫。就像顾城说的那样:草在结它的种子，风在摇它的叶子。我们站着，不说话，就很美好。</p>
<p>这样单纯的美好，值得每个人记住。那么，在疾走的时候，为什么不停下来看看呢?在砥砺前行的同时，注意到周围的芬芳，人生会更加无憾。
所以，奔赴远方的少年啊，请在追寻未来的同时，把握住现在。你实现梦想的未来是很美好，但载歌载舞的如今，同样值得依恋。</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="我们日常看文章的时候，其实已经在慢慢积累我们的审美意识，我们能分辨，哪篇推文看着舒服，哪篇文章看着辣眼睛。为了减少这种「辣眼睛」的情况出现，今天我就来谈谈关于文章排版的事情。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/article-formatting-guide">文章排版指南</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">2021年2月16日</time> · <!-- -->阅读需 10 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote>
<p>我们日常看文章的时候，其实已经在慢慢积累我们的审美意识，我们能分辨，哪篇推文看着舒服，哪篇文章看着辣眼睛。为了减少这种「辣眼睛」的情况出现，今天我就来谈谈关于文章排版的事情。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="博客排版">▎博客排版<a href="#博客排版" class="hash-link" aria-label="▎博客排版的直接链接" title="▎博客排版的直接链接">​</a></h3>
<p>写博客的同学都知道，现在博客都是由 Markdown 排版。如果你还不知到 Markdown 的话就去学习一下吧，它可以很方便地帮助我们排版出漂亮的文章。但我们在写博文的时候，仍有一些细节是需要注意的。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-空格">1. 空格<a href="#1-空格" class="hash-link" aria-label="1. 空格的直接链接" title="1. 空格的直接链接">​</a></h4>
<p>每次看到网页上的中文字和英文、数字、符号挤在一起，就会坐立不安，忍不住想在他们之间加个空格。</p>
<ul>
<li>
<p>中英文之间需要加空格</p>
<p><em>eg</em>. 大家可以微信搜一搜 solidSpoon 关注我。</p>
</li>
<li>
<p>中文与数字之间需要加空格</p>
<p><em>eg</em>. 不知不觉，我已经写博客 3 个月了。</p>
</li>
<li>
<p>数字与单位之间需要加空格</p>
<p><em>eg</em>. 我昨天买了一个 16 GB 的 U 盘。</p>
</li>
<li>
<p>完整的英文整句时标点后要加空格。</p>
<p><em>eg</em>. Love me, love my dog.</p>
</li>
</ul>
<p><strong>但是也有一些例外。</strong></p>
<ul>
<li>
<p>度的标志、百分号不加空格</p>
<p><em>eg</em>. 水的沸点是 100°。</p>
<p><em>eg</em>. 我的手机还有 75％ 的电量。</p>
</li>
<li>
<p>全角标点与其他字符之间不加空格</p>
<p><em>eg</em>. 大家好，我是 solidSpoon，欢迎访问我的博客。</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-标点">2. 标点<a href="#2-标点" class="hash-link" aria-label="2. 标点的直接链接" title="2. 标点的直接链接">​</a></h4>
<p>说到标点，不得不说下全角和半角，很多人可能不了解全角和半角的概念，这里顺便介绍下。</p>
<p>全角和半角是英文和中文的编码规范不同遗留下的问题，简单来说，全角占两个字节，半角占一个字节，你可以理解成中文汉子是全角，英文字母是半角，不过半角全角主要是针对标点符号来说的，中文标点占两个字节，英文标点占一个字节。体现在排版上的差异就是，全角字符屏幕打印宽度是两个，而半角字符屏幕打印宽度是一个，如中文逗号和英文逗号他们的显示分别是「，」和「,」。</p>
<ul>
<li>
<p>使用全角中文标点</p>
<p>中文排版中所有的标点都应该使用中文全角中文标点</p>
<p><em>eg</em>. 大家好，我是 solidSpoon。</p>
</li>
<li>
<p>遇到英文整句、特殊名词时使用半角标点。</p>
<p><em>eg</em>. 乔布斯说过：「Stay hungry, stay foolish.」</p>
<p><em>eg</em>. Facebook, Inc.</p>
</li>
<li>
<p>使用直角引号</p>
<ul>
<li>
<p>我国国家标准要求弯引号，但是个人建议在新媒体排版时使用直角引号。</p>
<p><em>eg</em>. 「我去吃饭了」，它起身说到。</p>
</li>
<li>
<p>如果引号再使用引号使用直角双引号。</p>
<p><em>eg</em>. 我对他说：「乔布斯说过：『Stay hungry, stay follish.』」</p>
</li>
</ul>
</li>
</ul>
<p><strong>微软拼音输入特殊符号方法：</strong></p>
<p>首先在中文输入界面输入 <code>u</code> 进入「u 模式输入」，然后跟着屏幕提示就可以找到你要输入的特殊符号了。</p>
<ul>
<li><em>eg</em>. 中文界面输入 <code>uubd</code> 就可以找到直角引号。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-其他">3. 其他<a href="#3-其他" class="hash-link" aria-label="3. 其他的直接链接" title="3. 其他的直接链接">​</a></h4>
<p>除以上之外，还有一些其他标准推荐大家使用的。</p>
<ul>
<li>
<p>英文名词首字母尽量大写</p>
<p>eg. Google、Android、Facebook</p>
</li>
<li>
<p>专有名词使用正确的大小写</p>
<p>eg. GitHub、iOS、iPhone XS Max、MacBook Pro</p>
</li>
<li>
<p>首行不要缩进</p>
</li>
</ul>
<p>关于首行不缩进可能有人不太同意，但是我要在这里解释下，在说明之前我们必须弄明白「首行缩进」的目的是什么。</p>
<p>「每段之前空两格」是我们从小学写作文就养成的习惯，也是正式文体的格式要求，其目的是为了区分自然段。</p>
<p>但是像我们现在接触的阅读，都是没有固定的格式要求的，如微信公众号、电子文档等，所以大家一般都采用「空出一行」进行自然段与自然段之间的区分，这种写作方式非常省事，而且很整齐。</p>
<p>所以，我认为这种应该是最科学的方式，只要没有明确的格式要求，写作的排版无须首行缩进。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="公众号排版">▎公众号排版<a href="#公众号排版" class="hash-link" aria-label="▎公众号排版的直接链接" title="▎公众号排版的直接链接">​</a></h3>
<p>用 Markdown 写作的确很方便。那么对于「不那么方便」的微信公众号，除了上面的那些外，又有什么是需要注意的呢？</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-大小">1. 大小<a href="#1-大小" class="hash-link" aria-label="1. 大小的直接链接" title="1. 大小的直接链接">​</a></h4>
<p>简单来说就是：标题要比正文大，正文要比标注大。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-颜色">2. 颜色<a href="#2-颜色" class="hash-link" aria-label="2. 颜色的直接链接" title="2. 颜色的直接链接">​</a></h4>
<p>颜色搭配保持统一，个别字体使用特殊色强调，字体颜色尽量不超过三种，颜色不要选取太亮的颜色，例如纯黑，纯红，亮红配亮绿，都是不建议的，看久了眼睛难免会疲惫，不利于阅读。</p>
<p><strong>建议使用字体颜色：</strong></p>
<ul>
<li>标题：使用公众号常用色，或者直接取 logo 或者行业色</li>
<li>正文：选择亮度没这么高的字体，这是纯黑 <code>#000000</code> ，比较偏灰会更加适合阅读 <code>#595757</code> <code>#3f3f3f</code> 等</li>
<li>批注：选择比正文亮度还低，更加浅的浅灰色，例如 <code>#595959</code> <code>#888888</code> <code>#d6d6d6</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-形态">3. 形态<a href="#3-形态" class="hash-link" aria-label="3. 形态的直接链接" title="3. 形态的直接链接">​</a></h4>
<p>和 word 编辑一样，公众号文字形态也可以做一些基本变化，例如 <strong>加粗</strong>、<em>斜体</em>、<u>下划线</u>、<del>删除线</del> 等，常用的是加粗，以及有趣（戏多）的删除线。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-对齐">4. 对齐<a href="#4-对齐" class="hash-link" aria-label="4. 对齐的直接链接" title="4. 对齐的直接链接">​</a></h4>
<p>对齐，可以说是拯救强迫症的最佳设置。这里推荐对齐方式为：<strong>两端对齐</strong>。</p>
<p>我们日常排版完会发现，因为句子的字符大小的原因，每行的最右边都会变得层次不齐，强 迫症看着会非常的不舒服，这时候如果我们选择两端对齐，就会美观的多。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-小符号">5. 小符号<a href="#5-小符号" class="hash-link" aria-label="5. 小符号的直接链接" title="5. 小符号的直接链接">​</a></h4>
<p>就像前面对标题的处理一样，简单的符号也能划分空间，也要常用引号，以此突出重点等</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-留白">6. 留白<a href="#6-留白" class="hash-link" aria-label="6. 留白的直接链接" title="6. 留白的直接链接">​</a></h4>
<p>在经过了文字的排版以后，整个版面的风格已经出来了，但是我们会发现，推文里字句的间距太密了，看久了眼睛很不舒服。其实，这都是因为：<u>没有留白，没有呼吸感</u>。</p>
<p>留白可以包括：</p>
<ul>
<li>页面边距</li>
<li>段 / 字 / 行间距</li>
<li>缩进</li>
<li>空行</li>
</ul>
<p><strong>页面边距</strong></p>
<p>页面边距指的是推文与手机屏幕两侧的距离。</p>
<p>默认距离是 0，我们可以设置，让文字离屏幕远一点。我个人建议页边距设置为 0.5，或者 1，比较舒服。</p>
<p><strong>段距</strong></p>
<p>段落与段落之间，图片与文字之间，都可以使用段前距、段后距进行调整距离，当然也可以使用空格代替。</p>
<p><strong>字间距</strong></p>
<p>字体之间的距离太密，容易让人错过重点内容，调整文字间距会有意想不到的效果，呼吸感瞬间有了。和字间距一样，行间距是解放原有行与行之间的重要一步。</p>
<ul>
<li>推荐参数：行间距 1.5 ~ 1.75、字间距 1</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-图片与表情包">7. 图片与表情包<a href="#7-图片与表情包" class="hash-link" aria-label="7. 图片与表情包的直接链接" title="7. 图片与表情包的直接链接">​</a></h4>
<p>适当的图片和表情可以增加阅读的兴趣</p>
<p><strong>浮动设置</strong></p>
<p>有的时候，我们会看到很多公众号通篇都是长图，而我们上传多图的时候，要么是图片太大上传不了，要么就是多图的时候出现空隙。这时候我们就只要让图片浮动就可以解决这个问题。</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="你是不是也一直觉得 OneNote、印象笔记、有道云笔记等等工具用起来都有一点不太舒服。我只想用一个简单方便，到哪都能用的笔记系统，但是市面上常见的笔记软件越来越臃肿，小众良心的软件又担心它会不会死掉，这里我给你提供一个思路。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/building-a-simple-and-user-friendly-note-taking-system">搭建简单好用的笔记系统</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">2021年2月16日</time> · <!-- -->阅读需 2 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>你是不是也一直觉得 OneNote、印象笔记、有道云笔记等等工具用起来  都有一点不太舒服。我只想用一个简单方便，到哪都能用的笔记系统，但是市面上常见的笔记软件越来越臃肿，小众良心的软件又担心它会不会死掉，这里我给你提供一个思路。</p>
<p>如果你想要一个全平台通用的、适合记笔记的文件格式，那么 Markdown 应该是一个不错的选择。Markdown 的语法简单、排版漂亮，配合像 Typora 这种优雅的编辑器能够在电脑端实现很棒的体验。</p>
<p>当然，Markdown 也有它的缺点。由于这种文件格式本身并不能保存图片，导致 Markdown 的使用者常常要自己想办法来解决全平台使用图片的问题。其中最省心的办法就是在类似阿里云、腾讯云这样大型的云服务商购买存储服务，配合 PicGo 这种小工具自己搭建一个图床，操作简单而且质量可靠。</p>
<p>更具体的操作方法你可以去搜索『阿里云 图床』这样的关键词。最后，使用坚果云这种全平台可用的同步盘来同步你的 Markdown 笔记。而且坚果云也有 Markdown 小工具，在手机和网页端浏览 Markdown 文件也比较方便。</p>
<p>希望你也喜欢这样的一种解决方案。</p>
<hr>
<p>题图由<a href="https://pixabay.com/zh/users/Monfocus-2516394/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1925752">Monfocus</a>在<a href="https://pixabay.com/zh/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1925752">Pixabay</a>上发布</p>
<p><img loading="lazy" src="https://ced-md-picture.oss-cn-beijing.aliyuncs.com/img/20200524165524.jpg" alt="list-1925752_1920" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/效率">效率</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="最近一直在学习 Git，但是一直不知道它的原理是什么，直到看到国外的一个大牛的博客。这篇博文给了我很大的启发，所以翻译过来和大家分享。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/git-is-a-purely-functional-data-structure">Git 是纯函数式数据结构</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">2021年2月16日</time> · <!-- -->阅读需 14 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote>
<p>最近一直在学习 Git，但是一直不知道它的原理是什么，直到看到国外的一个大牛的博客。这篇博文给了我很大的启发，所以翻译过来和大家分享。</p>
</blockquote>
<blockquote>
<p><a href="https://blog.jayway.com/2013/03/03/git-is-a-purely-functional-data-structure/" target="_blank" rel="noopener noreferrer">原文链接</a></p>
</blockquote>
<p>虽然近几年像 Git 这种分布式版本管理系统很火，但它看起来还是比像 SVN 这样的集中式版本控制系统复杂。我猜这可能是因为我们总是会把二者相比较：在 SVN 中这样做，但在 Git 中却需要那样 做。</p>
<p>我认为 Git 的真实含义应该是<strong>一个纯粹的函数式据结构</strong>。所以，如果你在学习熟练地使用 Git，那你也就是在学习处理数据结构。那么我们就先来探讨一下纯函数式数据结构。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="不变性">不变性<a href="#不变性" class="hash-link" aria-label="不变性的直接链接" title="不变性的直接链接">​</a></h3>
<p>函数式编程中一个很重要的概念就是不变性( immutablity )。就是说一个对象的状态在构造完成以后不可改变</p>
<p>比如有一个典型列表 <code>[3,2,1]</code>。如果这个列表是可变的，我们可以在他的头部插入一个元素4，即 <code>[4,3,2,1]</code>。现在它变成了一个全新的列表，之前的那个列表丢失了。如果此时其他的小伙伴也在操作这个列表，他们便会不幸地得到一个异常.</p>
<p>而函数式编程便不会发生这种情况。因为当我们在列表头部插入 <code>4</code> 时，它会创建一个新列表 <code>[4,3,2,1]</code>，而不会修改原始列表。所以两个列表会同时存在。</p>
<p>可是如果我们每次迭代这个列表都会生成一个全新的列表，这样不仅浪费，而且效率很低啊。</p>
<p>实际上，函数式数据结构的效率在很大程度上取决于对它们执行的操作。对于刚刚那种（单链接）列表，如果我们只是想在它的头部插入数据，完全可以用更有效率的方法：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | 4 +---&gt;+ 3 +---&gt;+ 2 +---&gt;+ 1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  +---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new list  original</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们将新元素 <code>4</code> 放在一个新节点中，并将它指向列表的其余部分。你看，之前的列表得到了复用，之前我们发现的那些问题全都解决了。</p>
<p>可是如果其他人想要在 <code>[3,2,1]</code> 之前插入 <code>9</code> 呢？当然也可以用这个方法啦：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">              +---+      +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new list 1 -&gt; | 4 +---+-&gt;+ 3 +---&gt;+ 2 +---&gt;+ 1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              +---+  /   +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    /      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              +---+/    original</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new list 2 -&gt; | 9 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们当然也可以将这样的元素存储为可变列表（non-immutable list），但是这很危险。假如我们更新列表中的元素 <code>[3]</code>，那部分可是公共的，你的修改会影响到他人，那些需要 <code>[9,3,2,1]</code> 列表的人可不喜欢你这么干。</p>
<p>但是......如果我确实需要将元素 <code>3</code> 变成 <code>5</code>，该怎么办？还是用老方法啊：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">                +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">updated list -&gt; | 4 +---&gt;+ 5 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +---+    +---+\    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +---+    +---+  \ +-+-+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new list 1 -&gt; | 4 +---&gt;+ 3 +---&gt;+ 2 +---&gt;+ 1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +---+  / +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      /    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +---+/  original</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new list 2 -&gt; | 9 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你看，它现在可以表示四个列表：</p>
<ul>
<li>最初的的列表 <code>[3,2,1]</code></li>
<li>list 1 <code>[4,3,2,1]</code></li>
<li>list 2 <code>[9,3,2,1]</code></li>
<li>list 2 <code>[4,5,2,1]</code></li>
</ul>
<p>纯函数数据结构在多线程编程中非常有用，因为来自不同线程的更改不会相互干扰。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="和-git-的关系">和 Git 的关系<a href="#和-git-的关系" class="hash-link" aria-label="和 Git 的关系的直接链接" title="和 Git 的关系的直接链接">​</a></h3>
<p>可是，我们之前讨论的不变性和 Git 的版本控制功能有什么关系呢？那我们就一起来对比以下它们俩的异同吧。</p>
<ul>
<li>在版本控制系统中我们想要完成的是：<!-- -->
<ol>
<li>使用新版本的文件更新我们的代码仓管库，旧版本文件也要保留。</li>
<li>当你和你的小伙伴门在同一个个代码库上进行协作时，不会以不可预测的方式相互干扰。</li>
</ol>
</li>
<li>不可变的数据结可以：<!-- -->
<ol>
<li>更新数据结构的同时保留老的数据结构。</li>
<li>在一个线程中对数据结构更改不会影响到其他线程</li>
</ol>
</li>
</ul>
<p>怎么样，是不是觉得它们俩很像。</p>
<p>事实上，我门甚至可以说 Git 基本上就是是一个纯粹的函数式数据结构，让你使用命令行客户端在其上执行操作。</p>
<p>要完成这个类比，我们需要把上面的数字替换成 Commit。</p>
<p>Git commints 是工作历史中特定时间点的全部工作状态的独立副本，即工作目录的完整快照。我们可以把示例中的链表看成是 Git 中的历史记录。</p>
<p>比如说我们有一个代码仓库，它的 <code>master</code> 分支包含三个按顺序的 commit : <code>A</code>，<code>B</code>，<code>C</code>。也就是我们让 Git 在整个开发过程中完整地存储了我们的工作目录三次。</p>
<p>这就是历史纪录啊，用图说话：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ C +---&gt;+ B +---&gt;+ A |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-commit">Git commit<a href="#git-commit" class="hash-link" aria-label="Git commit的直接链接" title="Git commit的直接链接">​</a></h3>
<p>当我们执行 commit 的时候，这就可以类比成我们将一个数据提交到了这个历史纪录的开头。而 Git 甚至用 <code>HEAD</code> 代表当前的 commit。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+ D +---&gt;+ C +---&gt;+ B +---&gt;+ A |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master   master^</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当 Git 执行 commit 时，它会移动当前分支指针，将 <code>master</code> 指向 <code>[D,C,B,A]</code>。我们仍然
可以通过名称 <code>master^</code> 指向 <code>[C,B,A]</code>，并且不会影响到其他人。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-amend">Git amend<a href="#git-amend" class="hash-link" aria-label="Git amend的直接链接" title="Git amend的直接链接">​</a></h3>
<p>如果你使用过 Git，你或许知道可以使用 <code>commit --amend</code> 来更新最近一次的 commit  ，但你真的可以更新 commit 吗？</p>
<p>事实上，你不能。Git 只是创建一个新的 commit （下图中 E）并将 branch 指针指向它。你仍然可以使用 <code>git reflog</code> 命令看到它，并且可以通过它的 hash value 来引用（假设他的 hash value 是 ef4d34）。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ef4d34 -&gt; | D +--+&gt;+ C +---&gt;+ B +---&gt;+ A |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+ /  +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               /     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    master^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master -&gt; | E |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-branch">Git branch<a href="#git-branch" class="hash-link" aria-label="Git branch的直接链接" title="Git branch的直接链接">​</a></h3>
<p>如你所见，每次执行 <code>commit --amend</code> 时，实际上都会创建一个新分支。分支的唯一功能就是给我们能引用的 commit 起个名字。我们甚至可以使用 <code>git checkout -b branch ef3d34</code> 命令在那个被丢弃的 commit <code>ef3d34</code> 上创建一个新分支。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">branch -&gt; | D +--+&gt;+ C +---&gt;+ B +---&gt;+ A |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+ /  +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               /     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+  master^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master -&gt; | E |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通常，我们通过为当前的工作流 <code>HEAD</code> 创建一个新名称来在 Git 中进行分支，但是如果你将 Git 理解为一个函数式数据结构，你就可以随心所欲地在这个树状图上的任何一个 commit 上创建分支了。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-rebase">Git rebase<a href="#git-rebase" class="hash-link" aria-label="Git rebase的直接链接" title="Git rebase的直接链接">​</a></h3>
<p>当我们在上边的示例列表中更新一个节点时,我们必须把列表中的每个节点添加到在更新后的元素之前（在我们的示例中，这是单个节点 <code>4</code>，但可以是任意数量的节点）。在 Git 中，这称为重新提交（replaying commits），执行此操作的命令称为变基（rebase）。要更新旧提交，我们添加 <code>-i</code> 参数来执行一个在 Git 中称被叫做「交互式 rebase」的操作。</p>
<p>比如说，我们想要用一个新的 commit message 来更新 commit <code>C</code>。我们需要切换到 commit <code>D</code>，然后输入 <code>git rebase -i c</code> 。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; git checkout D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; git rebase -i C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在窗口中包含一下内容：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick cd3ff32 &lt;C&#x27;s commit message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick a65a671 &lt;D&#x27;s commit message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># some helpful comments from git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果我们想编辑 cimmit <code>C</code>，Git 允许我们在重放后续提交之前编辑该提交。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">edit cd3ff32 &lt;C&#x27;s commit message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick a65a671 &lt;D&#x27;s commit message&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当我们保存文件并关闭它时，Git 会开始一个 rebase 。它会在 commit <code>C</code> 停止，这样我们可以修改它。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Stopped at cd3ff32... &lt;C&#x27;s commit message&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can amend the commit now, with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        git commit --amend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Once you are satisfied with your changes, run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        git rebase --continue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>窗口中的消息说明了一切。我们可以根据需要随意编辑 commit 后我们调用 <code>commit --amend</code> 创建更新的 commit，然后使用「继续 rebase」指令： <code>git rebase --continue</code>。
当我们选择命令时，其余的 commit 将一个接一个地重放 <code>pick</code>（除非最终发生了合并冲突，在这种情况下 Git 会停止并在你修复它之后才能继续）。我们的完整存储库现在就像下边这样。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rebased -&gt;| D&#x27;+---&gt;+ C&#x27;+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+    +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">branch -&gt; | D +--+&gt;+ C +---&gt;+ B +---&gt;+ A |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+ /  +---+    +---+    +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               /     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+  master^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master -&gt; | E |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我希望上面的图会让你觉得熟悉。希望你也能明白为什么 Git 的 rebase 命令会创建所有新的 commit。Git 是一个函数式数据结构，它不允许更改现有的 commit。</p>
<p>由于 rebase 引入了一个新的提交链，所以我们一定希望能够对这个新链的外观进行必要的且任意的控制。我们可以用 <code>rebase -i</code> 来重新排序，压缩或删除提交，或者随意拉入新的提交，比如把一个 commit 分成几部分，或者从存储仓库中的其他位置开始（使用 <code>--onto</code> 参数）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="git-merge">Git merge<a href="#git-merge" class="hash-link" aria-label="Git merge的直接链接" title="Git merge的直接链接">​</a></h3>
<p>现在我们来谈谈合并把。Git 允许我们将两个分支合并为一个</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --+ X |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+/  +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| M |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---+   +---+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --+ Y |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        +---+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>合并給我们的模型带来了更多的复杂性。它把我们的历史从一个树状图变成了一个非循环图。这并没有太大的改变，但请注意，虽然 rebase 听起来复杂，但只有 merge 命令带来了额外的概念复杂性。</p>
<p>可以通过在新方向上应用新提交来理解 Rebase 。合并是一种根本不同的操作。一个数据结构，一个你可以将两个部分像这样组合成数据结构一个特殊的名称：我们称它 confluently persistent。（函数式数据结构也叫 persistent。我避免使用
这个术语，所以你不要将它与像物理光盘这样的持久性媒体上的存储概念混淆。）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="结论的直接链接" title="结论的直接链接">​</a></h3>
<p>Git可以看成是一个相当简单的函数式数据结构。与其把Git描述成一个版本控制系统，不如说版本控制是“不变性”数据结构的一个自然属性。。我认为以这种方式谈论 Git 能更准确地传达 Git 的简单性和威力，而不是与集中式版本控制系统相比能完成什么。</p>
<p>如果以这种方式来思考的话，Git 在概念上比 SVN, CVS 等要简单。 大家认为 Git 更加复杂可能是因为这种复杂性能支持更有趣的 workflow。</p>
<p>如果你曾经觉得 Git 令人生畏，那请记住它的简单结构，以及在函数式结构中，
插入其中的任何东西都不会真正丢失，并且可以被恢复。（检查你的 <code>reflog</code>）</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/翻译">翻译</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/git">Git</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="你肯定知道在浏览器中按下 F12 打开开发者工具，在其中修改源代码就可以更改网页上的任意内容。那么有没有办法可以不看源码，通过「所见即所得」的方式直接在页面上修改呢"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/how-to-visually-edit-web-page-elements">怎么直观地给网页「P 图」</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-02-16T00:00:00.000Z" itemprop="datePublished">2021年2月16日</time> · <!-- -->阅读需 2 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/solidSpoon.png" alt="solidSpoon" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/solidSpoon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">solidSpoon</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of Hide</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>你肯定知道在浏览器中按下 F12 打开开发者工具，在其中修改源代码就可以更改网页上的任意内容。那么有没有办法可以不看源码，通过「所见即所得」的方式直接在页面上修改呢</p>
<p><img loading="lazy" src="https://ced-md-picture.oss-cn-beijing.aliyuncs.com/img/20201215204850.gif" alt="演示" class="img_ev3q"></p>
<p>下面这两个属性可以帮助我们实现这一想法：</p>
<ol>
<li>使用 <code>contentEditable</code> 属性</li>
<li>使用 <code>designMode</code> 属性</li>
</ol>
<p>这两个属性用来帮助开发人员创建网页 端的富文本编辑器，因此如果我们将整个网页都应用这两个属性，都可以达到可视化编辑网页的效果。</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">contentEditable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">designMode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;on&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>designMode</code> 是 document 级别的属性</p>
<p><code>contentEditable</code> 是元素级别的属性</p>
<p>当一个 HTML 文档被切换到 designMode 时，我们就可以使用 <code>document.execCommand</code> 方法，我们可以通过这个方法对文档中的内容添加<strong>粗体</strong>、<em>斜体</em>、缩进、对某段文字添加一个链接等等。</p>
<p>例如，下面的代码就会给选中的文本加上链接</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">execCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;CreateLink&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;http://www.baidu.com&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用这些方法，我们就可以很容易的用可视化的方式改网页了。当然，你肯定不想在控制台敲这么长的命令，所以找一些可以在浏览器运行脚本的软件来简化这个过程。</p>
<p>这儿有一个简单的示例希望可以帮助到你</p>
<p><a href="https://getquicker.net/sharedaction?code=f7db1234-2681-4c6a-82a4-08d83ad18965" target="_blank" rel="noopener noreferrer">https://getquicker.net/sharedaction?code=f7db1234-2681-4c6a-82a4-08d83ad18965</a></p>
<p><img loading="lazy" src="https://ced-md-picture.oss-cn-beijing.aliyuncs.com/img/20201215213916.gif" alt="" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/教程">教程</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog"><div class="pagination-nav__label">较新的博文</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/3"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Hide - solidSpoon, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>