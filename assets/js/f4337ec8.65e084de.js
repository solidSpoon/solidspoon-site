"use strict";(self.webpackChunksolidspoon_site=self.webpackChunksolidspoon_site||[]).push([[5068],{3055:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var l=s(5893),o=s(1151);const r={slug:"win10-mysql-5-7-docker-building-master-slave-replication",title:"Win10 - MySQL 5.7 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},i=void 0,a={permalink:"/blog/win10-mysql-5-7-docker-building-master-slave-replication",editUrl:"https://github.com/solidSpoon/solidSpoon.github.io/tree/main/packages/create-docusaurus/templates/shared/blog/2021/02-17-win10-mysql-5-7-docker-building-master-slave-replication/index.md",source:"@site/blog/2021/02-17-win10-mysql-5-7-docker-building-master-slave-replication/index.md",title:"Win10 - MySQL 5.7 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",description:"\u642d\u5efa\u73af\u5883\uff1aWindows 10 Docker Desktop WSL 2 based engine",date:"2021-02-17T00:00:00.000Z",formattedDate:"2021\u5e742\u670817\u65e5",tags:[{label:"\u6559\u7a0b",permalink:"/blog/tags/\u6559\u7a0b"}],readingTime:2.715,hasTruncateMarker:!1,authors:[{name:"solidSpoon",title:"Maintainer of Hide",url:"https://github.com/solidSpoon",imageURL:"https://github.com/solidSpoon.png",key:"solidSpoon"}],frontMatter:{slug:"win10-mysql-5-7-docker-building-master-slave-replication",title:"Win10 - MySQL 5.7 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},unlisted:!1,prevItem:{title:"MySQL 8.0 \u642d\u5efa\u534a\u540c\u6b65\u590d\u5236",permalink:"/blog/mysql-8-0-building-semi-synchronous-replication"},nextItem:{title:"Win10 - MySQL 8.0 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",permalink:"/blog/win10-mysql-8-0-docker-building-master-slave-replication"}},t={authorsImageUrls:[void 0]},c=[{value:"\u521b\u5efa",id:"\u521b\u5efa",level:2},{value:"\u7f16\u5199 docker-conpose \u6587\u4ef6",id:"\u7f16\u5199-docker-conpose-\u6587\u4ef6",level:3},{value:"\u7f16\u5199 cnf \u6587\u4ef6",id:"\u7f16\u5199-cnf-\u6587\u4ef6",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"Master",id:"master",level:3},{value:"Slave",id:"slave",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u642d\u5efa\u73af\u5883\uff1aWindows 10 Docker Desktop WSL 2 based engine"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u521b\u5efa",children:"\u521b\u5efa"}),"\n",(0,l.jsx)(n.p,{children:"\u9996\u5148\u521b\u5efa\u4e24\u4e2a\u6570\u636e\u5e93\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u4e3b\u5e93\uff0c\u53e6\u4e00\u4e2a\u4f5c\u4e3a\u4ece\u5e93"}),"\n",(0,l.jsx)(n.h3,{id:"\u7f16\u5199-docker-conpose-\u6587\u4ef6",children:"\u7f16\u5199 docker-conpose \u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u9996\u5148\u5b89\u88c5 docker\uff0cdocker-compose\n\u4e00\u822c\u5b89\u88c5\u4e86 docker \u90fd\u4f1a\u5b89\u88c5 docker-compose\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"docker-compose -verison"})," \u67e5\u770b\u662f\u5426\u5b89\u88c5"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"docker pull mysql:5.7"})," \u62c9\u53d6 mysql5.7 \u955c\u50cf"]}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u5199 docker-compose \u6587\u4ef6\u300cdocker-compose.yaml\u300d"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"version: '2' \nnetworks:\n  byfn:                                       #\u914d\u7f6ebyfn\u7f51\u7edc\nservices:\n  master:                                     #\u914d\u7f6emaster\u670d\u52a1\n    image: 'mysql:5.7'                        #\u4f7f\u7528\u521a\u624dpull\u4e0b\u6765\u7684\u955c\u50cf\n    restart: always\n    container_name: mysql-master              #\u5bb9\u5668\u8d77\u540d mysql-master\n    environment:\n      MYSQL_USER: test\n      MYSQL_PASSWORD: admin123\n      MYSQL_ROOT_PASSWORD: admin123           #\u914d\u7f6eroot\u7684\u5bc6\u7801\n    ports:\n      - '3316:3306'                           #\u914d\u7f6e\u7aef\u53e3\u6620\u5c04\n    volumes:\n      - \"./master/my.cnf:/etc/mysql/my.cnf\"   #\u914d\u7f6emy.cnf\u6587\u4ef6\u6302\u8f7d\uff0c\n    networks:\n      - byfn                                  #\u914d\u7f6e\u5f53\u524dservie\u6302\u8f7d\u7684\u7f51\u7edc\n  slave:                                      #\u914d\u7f6eslave\u670d\u52a1\n    image: 'mysql:5.7'\n    restart: always\n    container_name: mysql-slave\n    environment:\n      MYSQL_USER: test\n      MYSQL_PASSWORD: admin123\n      MYSQL_ROOT_PASSWORD: admin123\n    ports:\n      - '3326:3306'\n    volumes:\n      - \"./slave/my.cnf:/etc/mysql/my.cnf\"\n    networks:\n      - byfn\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u7f16\u5199-cnf-\u6587\u4ef6",children:"\u7f16\u5199 cnf \u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"docker-compose.yaml"})," \u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u5efa\u7acb\u4e24\u4e2a\u6587\u4ef6\u5939\uff0cmaster \u548c slave\uff0c\u91cc\u9762\u5206\u522b\u5199\u5165\u6587\u4ef6\u300cmy.cnf\u300d"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"mater/my.cnf\n\n[mysqld]\nserver-id=1\nlog-bin=/var/lib/mysql/mysql-bin\n\nslave/my.cnf\n\n\n[mysqld]\nserver-id=2\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5206\u522b\u4fdd\u5b58\u540e\u9000\u51fa"}),"\n",(0,l.jsx)(n.p,{children:"\u7136\u540e\u5728\u5f53\u524d docker-compose.yaml \u6587\u4ef6\u76ee\u5f55\u4e0b\u6267\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker-compose -f docker-compse.yaml up -d\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u65f6\u4e24\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u6210\u529f"}),"\n",(0,l.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"master",children:"Master"}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8\u4e4b\u540e\u8fdb\u5165 master \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it mysql-master /bin/bash\nmysql -uroot -padmin123\n\u8fdb\u5165 mysql \u7ec8\u7aef\u4e4b\u540e\nmysql> create user 'repl'@'%' identified by 'admin123';\nmysql> GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'repl'@'%'; \nmysql> flush privileges;\nmysql> show master status;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6700\u540e\u7684 ",(0,l.jsx)(n.code,{children:"show master status;"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mysql> show master status;\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000003 |      767 |              |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9700\u8981\u8bb0\u4f4f File \u540d\u5b57\uff0c\u548c Position \u504f\u79fb\u4f4d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"slave",children:"Slave"}),"\n",(0,l.jsx)(n.p,{children:"\u53e6\u8d77\u4e00\u4e2a\u7ec8\u7aef\u8fdb\u5165 slave \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it mysql-slave /bin/bash\nmysql -uroot -padmin123\n\u8fdb\u5165 mysql \u7ec8\u7aef\u4e4b\u540e\nmysql> CHANGE MASTER TO MASTER_HOST='mysql-master', MASTER_PORT=3306,  MASTER_USER='repl', MASTER_PASSWORD='admin123', MASTER_LOG_FILE='mysql-bin.000003', MASTER_LOG_POS=767;\nmysql> start slave;\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u4e24\u4e2a\u53c2\u6570 MASTER_LOG_FILE \u548c MASTER_LOG_POS \u5c31\u662f\u524d\u9762 master \u4e0a\u6700\u540e\u67e5\u8be2\u51fa\u6765\u7684\uff1b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"mysql> show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: mysql-master\n                  Master_User: repl\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000003\n          Read_Master_Log_Pos: 1116\n               Relay_Log_File: eefecaed2964-relay-bin.000002\n                Relay_Log_Pos: 320\n        Relay_Master_Log_File: mysql-bin.000003\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table:\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u8be2 slave \u7684\u72b6\u6001\uff0c\u770b\u5230 Slave_IO_Running \u548c Slave_SQL_Running \u90fd\u662f yes \u5373\u4e3a\u540c\u6b65\u6210\u529f"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u767b\u5f55 master \u4e0a\u521b\u5efa\u6570\u636e\u5e93\uff0c\u8868\uff0c\u7136\u540e\u5728 slave \u8fd9\u8fb9\u67e5\u770b\u6570\u636e\u662f\u5426\u540c\u6b65"})]})}function m(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>i});var l=s(7294);const o={},r=l.createContext(o);function i(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);