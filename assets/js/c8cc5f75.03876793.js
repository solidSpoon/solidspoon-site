"use strict";(self.webpackChunksolidspoon_site=self.webpackChunksolidspoon_site||[]).push([[4616],{191:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>a,metadata:()=>t,toc:()=>o});var l=n(5893),i=n(1151);const a={slug:"mysql-8-0-building-semi-synchronous-replication",title:"MySQL 8.0 \u642d\u5efa\u534a\u540c\u6b65\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},r=void 0,t={permalink:"/blog/mysql-8-0-building-semi-synchronous-replication",editUrl:"https://github.com/solidSpoon/solidSpoon.github.io/tree/main/packages/create-docusaurus/templates/shared/blog/2021/02-17-mysql-8-0-building-semi-synchronous-replication/index.md",source:"@site/blog/2021/02-17-mysql-8-0-building-semi-synchronous-replication/index.md",title:"MySQL 8.0 \u642d\u5efa\u534a\u540c\u6b65\u590d\u5236",description:"\u8bf4\u660e\uff1a\u642d\u5efa\u534a\u540c\u6b65\u590d\u5236\u9700\u8981\u9884\u5148\u6709\u57fa\u672c\u7684\u4e3b\u4ece\u590d\u5236\u73af\u5883\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u4e4b\u524d\u7684\u6587\u7ae0\uff1a",date:"2021-02-17T00:00:00.000Z",formattedDate:"2021\u5e742\u670817\u65e5",tags:[{label:"\u6559\u7a0b",permalink:"/blog/tags/\u6559\u7a0b"}],readingTime:3.725,hasTruncateMarker:!1,authors:[{name:"solidSpoon",title:"Maintainer of Hide",url:"https://github.com/solidSpoon",imageURL:"https://github.com/solidSpoon.png",key:"solidSpoon"}],frontMatter:{slug:"mysql-8-0-building-semi-synchronous-replication",title:"MySQL 8.0 \u642d\u5efa\u534a\u540c\u6b65\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},unlisted:!1,prevItem:{title:"Docker \u7f51\u7edc\u8bbe\u7f6e",permalink:"/blog/docker-network-configuration"},nextItem:{title:"Win10 - MySQL 5.7 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",permalink:"/blog/win10-mysql-5-7-docker-building-master-slave-replication"}},c={authorsImageUrls:[void 0]},o=[{value:"Master \u914d\u7f6e",id:"master-\u914d\u7f6e",level:2},{value:"Slave \u914d\u7f6e",id:"slave-\u914d\u7f6e",level:2},{value:"\u9a8c\u8bc1",id:"\u9a8c\u8bc1",level:2},{value:"Slave",id:"slave",level:3},{value:"\u5173\u95ed\u534a\u540c\u6b65;",id:"\u5173\u95ed\u534a\u540c\u6b65",level:2},{value:"Master",id:"master",level:3}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.p,{children:"\u8bf4\u660e\uff1a\u642d\u5efa\u534a\u540c\u6b65\u590d\u5236\u9700\u8981\u9884\u5148\u6709\u57fa\u672c\u7684\u4e3b\u4ece\u590d\u5236\u73af\u5883\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u4e4b\u524d\u7684\u6587\u7ae0\uff1a"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"https://github.com/solidSpoon/solidSpoon.github.io/wiki",children:"https://github.com/solidSpoon/solidSpoon.github.io/wiki"})}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"\u534a\u540c\u6b65\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u964d\u4e3a\u5f02\u6b65\u5de5\u4f5c\u3002\u5f53Slave\u5f00\u542f\u534a\u540c\u6b65\u540e\uff0c\u6216\u8005\u5f53\u4e3b\u4ece\u4e4b\u95f4\u7f51\u7edc\u5ef6\u8fdf\u6062\u590d\u6b63\u5e38\u7684\u65f6\u5019\uff0c\u534a\u540c\u6b65\u590d\u5236\u4f1a\u81ea\u52a8\u4ece\u5f02\u6b65\u590d\u5236\u53c8\u8f6c\u4e3a\u534a\u540c\u6b65\u590d\u5236\uff0c\u8fd8\u662f\u76f8\u5f53\u667a\u80fd\u7684\u3002"}),"\n",(0,l.jsx)(s.h2,{id:"master-\u914d\u7f6e",children:"Master \u914d\u7f6e"}),"\n",(0,l.jsx)(s.p,{children:"\u5b89\u88c5\u534a\u540c\u6b65\u6a21\u5757\u5e76\u542f\u52a8"}),"\n",(0,l.jsx)(s.p,{children:"\u8fd9\u91cc Windows \u7248\u672c\u6709\u4e2a\u5751"}),"\n",(0,l.jsxs)(s.p,{children:["\u5bf9\u4e8e Linux \u6765\u8bf4\uff1a\u6b64\u6a21\u5757\u4f4d\u7f6e\u5728 ",(0,l.jsx)(s.code,{children:"/usr/local/mysql/lib/plugin/semisync_master.so"}),"\n\u5bf9\u4e8e Windows Zip \u7248\u672c\u6765\u8bf4\uff1a\u63d2\u4ef6\u7684\u4f4d\u7f6e\u672c\u6765\u5728 ",(0,l.jsx)(s.code,{children:"..\\lib\\semisync_master.dll"})," \uff0c\u4f46\u662f MySQL \u9ed8\u8ba4\u7684\u4f4d\u7f6e\u662f ",(0,l.jsx)(s.code,{children:"\\bin\\lib\\plugin\\semisync_master.so"}),"\xa0"]}),"\n",(0,l.jsx)(s.p,{children:"\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u628a lib \u76ee\u5f55\u590d\u5236\u4e00\u4efd\u8fc7\u53bb\u5c31\u597d\u4e86\u3002"}),"\n",(0,l.jsx)(s.p,{children:"\u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u63d2\u4ef6\u76ee\u5f55\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"[mysqld]\nplugin_dir=/path/to/plugin/directory\n"})}),"\n",(0,l.jsxs)(s.p,{children:["\u5982\u679c ",(0,l.jsx)(s.a,{href:"https://www.docs4dev.com/docs/zh/mysql/5.7/reference/server-system-variables.html#sysvar_plugin_dir",children:"plugin_dir"})," \u7684\u503c\u662f\u76f8\u5bf9\u8def\u5f84\u540d\uff0c\u5219\u5c06\u5176\u89c6\u4e3a\u76f8\u5bf9\u4e8e MySQL \u57fa\u672c\u76ee\u5f55\uff08 ",(0,l.jsx)(s.a,{href:"https://www.docs4dev.com/docs/zh/mysql/5.7/reference/server-system-variables.html#sysvar_basedir",children:"basedir"})," \u7cfb\u7edf\u53d8\u91cf\u7684\u503c\uff09\u3002"]}),"\n",(0,l.jsx)(s.p,{children:"\u4e0b\u9762\u662f\u5b89\u88c5\u6a21\u5757\u7684\u547d\u4ee4\uff1a"}),"\n",(0,l.jsx)(s.p,{children:"Linux\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> install plugin rpl_semi_sync_master soname 'semisync_master.so';\n"})}),"\n",(0,l.jsx)(s.p,{children:"Windows\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> install plugin rpl_semi_sync_master soname 'semisync_master.dll';\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u5b89\u88c5\u5b8c\u540e\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> show global variables like '%semi%';\n"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> show global variables like '%semi%';\n+-------------------------------------------+------------+\n| Variable_name                             | Value      |\n+-------------------------------------------+------------+\n| rpl_semi_sync_master_enabled              | OFF        | -> \u662f\u5426\u542f\u7528\u534a\u540c\u6b65\u534f\u8bae\n| rpl_semi_sync_master_timeout              | 10000      | -> \u94fe\u63a5 Slave \u8d85\u65f6\u65f6\u95f4\n| rpl_semi_sync_master_trace_level          | 32         |\n| rpl_semi_sync_master_wait_for_slave_count | 1          |\n| rpl_semi_sync_master_wait_no_slave        | ON         |\n| rpl_semi_sync_master_wait_point           | AFTER_SYNC | -> MySQL 5.7 \u4e4b\u540e\u9ed8\u8ba4\u503c\n+-------------------------------------------+------------+\n6 rows in set, 1 warning (0.02 sec)\n"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> set global rpl_semi_sync_master_enabled = 1;\nmysql> set global rpl_semi_sync_master_timeout = 2000;\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u5b89\u88c5\u540e\u542f\u52a8\u548c\u5b9a\u5236\u4e3b\u4ece\u8fde\u63a5\u9519\u8bef\u7684\u8d85\u65f6\u65f6\u95f4\u9ed8\u8ba4\u662f 10s \u53ef\u6539\u4e3a 2s\uff0c\u4e00\u65e6\u6709\u4e00\u6b21\u8d85\u65f6\u81ea\u52a8\u964d\u7ea7\u4e3a\u5f02\u6b65\u3002\uff08\u4ee5\u4e0a\u5185\u5bb9\u8981\u60f3\u6c38\u4e45\u6709\u6548\u9700\u8981\u5199\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\uff09"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"[root@localhost ~]# cat /etc/my.cnf\n[mysqld]\nrpl_semi_sync_master_enabled = 1;\nrpl_semi_sync_master_timeout = 2000;\n"})}),"\n",(0,l.jsx)(s.h2,{id:"slave-\u914d\u7f6e",children:"Slave \u914d\u7f6e"}),"\n",(0,l.jsx)(s.p,{children:"1\uff09\u5b89\u88c5\u534a\u540c\u6b65\u6a21\u5757\u5e76\u542f\u52a8"}),"\n",(0,l.jsx)(s.p,{children:"Linux\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> install plugin rpl_semi_sync_slave soname 'semisync_slave.so';\n"})}),"\n",(0,l.jsx)(s.p,{children:"WIndows\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> install plugin rpl_semi_sync_slave soname 'semisync_slave.dll';\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u540c\u6837\uff0c\u5982\u679c\u62a5\u9519\u5c31\u628a\u63d2\u4ef6\u76ee\u5f55\u79fb\u52a8\u4e00\u4e0b"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"lib"})," -> ",(0,l.jsx)(s.code,{children:"bin\\lib"})]}),"\n",(0,l.jsx)(s.p,{children:"\u63a5\u7740\u6267\u884c"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> set global rpl_semi_sync_slave_enabled = 1;\nmysql> show global variables like '%semi%';\n+-------------------------------------------+------------+\n| Variable_name                             | Value      |\n+-------------------------------------------+------------+\n| rpl_semi_sync_master_enabled              | ON         |\n| rpl_semi_sync_master_timeout              | 10000      |\n| rpl_semi_sync_master_trace_level          | 32         |\n| rpl_semi_sync_master_wait_for_slave_count | 1          |\n| rpl_semi_sync_master_wait_no_slave        | ON         |\n| rpl_semi_sync_master_wait_point           | AFTER_SYNC |\n| rpl_semi_sync_slave_enabled               | ON         |\n| rpl_semi_sync_slave_trace_level           | 32         |\n+-------------------------------------------+------------+\n8 rows in set, 1 warning (0.00 sec)\n"})}),"\n",(0,l.jsx)(s.p,{children:"2\uff09\u4ece\u8282\u70b9\u9700\u8981\u91cd\u65b0\u8fde\u63a5\u4e3b\u670d\u52a1\u5668\u534a\u540c\u6b65\u624d\u4f1a\u751f\u6548"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> stop slave io_thread;\nmysql> start slave io_thread;\n"})}),"\n",(0,l.jsx)(s.p,{children:"PS\uff1a\u5982\u679c\u60f3\u5378\u8f7d\u5f02\u6b65\u6a21\u5757\u5c31\u4f7f\u7528 uninstall \u5373\u53ef\u3002"}),"\n",(0,l.jsx)(s.p,{children:"Master \u4e0a\u67e5\u770b\u662f\u5426\u542f\u7528\u4e86\u534a\u540c\u6b65"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.img,{src:"https://ced-md-picture.oss-cn-beijing.aliyuncs.com/img/20210203214530.png",alt:""})}),"\n",(0,l.jsxs)(s.p,{children:["\u73b0\u5728\u534a\u540c\u6b65\u5df2\u7ecf\u6b63\u5e38\u5de5\u4f5c\u4e86\uff0c\u4e3b\u8981\u770b ",(0,l.jsx)(s.code,{children:"Rpl_semi_sync_master_clients"})," \u662f\u5426\u4e0d\u4e3a 0\uff0c",(0,l.jsx)(s.code,{children:"Rpl_semi_sync_master_status"})," \u662f\u5426\u4e3a ON\u3002\u5982\u679c ",(0,l.jsx)(s.code,{children:"Rpl_semi_sync_master_status"})," \u4e3a OFF\uff0c\u8bf4\u660e\u51fa\u73b0\u4e86\u7f51\u7edc\u5ef6\u8fdf\u6216 Slave IO \u7ebf\u7a0b\u5ef6\u8fdf\u3002"]}),"\n",(0,l.jsx)(s.h2,{id:"\u9a8c\u8bc1",children:"\u9a8c\u8bc1"}),"\n",(0,l.jsx)(s.p,{children:"\u534a\u540c\u6b65\u8d85\u65f6\uff0c\u662f\u5426\u4f1a\u81ea\u52a8\u964d\u4e3a\u5f02\u6b65\u5de5\u4f5c"}),"\n",(0,l.jsx)(s.h3,{id:"slave",children:"Slave"}),"\n",(0,l.jsx)(s.h2,{id:"\u5173\u95ed\u534a\u540c\u6b65",children:"\u5173\u95ed\u534a\u540c\u6b65;"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> set global rpl_semi_sync_slave_enabled = 0 ;\nmysql> stop slave io_thread;\nmysql> start slave io_thread;\n"})}),"\n",(0,l.jsx)(s.h3,{id:"master",children:"Master"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"mysql> insert into t1(id) values(5),(4);\nQuery OK, 2 rows affected (10.06 sec)\nmysql> insert into t1(id) values(6),(7);\nQuery OK, 2 rows affected (0.03 sec)\n"})})]})}function m(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},1151:(e,s,n)=>{n.d(s,{Z:()=>t,a:()=>r});var l=n(7294);const i={},a=l.createContext(i);function r(e){const s=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(a.Provider,{value:s},e.children)}}}]);