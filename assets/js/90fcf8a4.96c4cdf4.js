"use strict";(self.webpackChunksolidspoon_site=self.webpackChunksolidspoon_site||[]).push([[1977],{5155:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var l=s(5893),i=s(1151);const r={slug:"win10-mysql-8-0-docker-building-master-slave-replication",title:"Win10 - MySQL 8.0 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},a=void 0,o={permalink:"/blog/win10-mysql-8-0-docker-building-master-slave-replication",editUrl:"https://github.com/solidSpoon/solidSpoon.github.io/tree/main/packages/create-docusaurus/templates/shared/blog/2021/02-17-win10-mysql-8-0-docker-building-master-slave-replication/index.md",source:"@site/blog/2021/02-17-win10-mysql-8-0-docker-building-master-slave-replication/index.md",title:"Win10 - MySQL 8.0 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",description:"\u642d\u5efa\u73af\u5883\uff1aWindows 10 Docker Desktop WSL 2 based engine",date:"2021-02-17T00:00:00.000Z",formattedDate:"2021\u5e742\u670817\u65e5",tags:[{label:"\u6559\u7a0b",permalink:"/blog/tags/\u6559\u7a0b"}],readingTime:3.8,hasTruncateMarker:!1,authors:[{name:"solidSpoon",title:"Maintainer of Hide",url:"https://github.com/solidSpoon",imageURL:"https://github.com/solidSpoon.png",key:"solidSpoon"}],frontMatter:{slug:"win10-mysql-8-0-docker-building-master-slave-replication",title:"Win10 - MySQL 8.0 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",authors:["solidSpoon"],tags:["\u6559\u7a0b"]},unlisted:!1,prevItem:{title:"Win10 - MySQL 5.7 - Docker \u642d\u5efa\u4e3b\u4ece\u590d\u5236",permalink:"/blog/win10-mysql-5-7-docker-building-master-slave-replication"},nextItem:{title:"Win10 - MySQL 8 Zip \u7248 - \u642d\u5efa\u57fa\u4e8e GTID \u7684\u4e3b\u4ece\u590d\u5236",permalink:"/blog/win10-mysql-8-zip-version-building-gtid-based-master-slave-replication"}},t={authorsImageUrls:[void 0]},c=[{value:"\u521b\u5efa",id:"\u521b\u5efa",level:2},{value:"\u7f16\u5199 docker-conpose \u6587\u4ef6",id:"\u7f16\u5199-docker-conpose-\u6587\u4ef6",level:3},{value:"\u7f16\u5199 cnf \u6587\u4ef6",id:"\u7f16\u5199-cnf-\u6587\u4ef6",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"Master",id:"master",level:3},{value:"Slave",id:"slave",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u642d\u5efa\u73af\u5883\uff1aWindows 10 Docker Desktop WSL 2 based engine"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u521b\u5efa",children:"\u521b\u5efa"}),"\n",(0,l.jsx)(n.p,{children:"\u9996\u5148\u521b\u5efa\u4e24\u4e2a\u6570\u636e\u5e93\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u4e3b\u5e93\uff0c\u53e6\u4e00\u4e2a\u4f5c\u4e3a\u4ece\u5e93"}),"\n",(0,l.jsx)(n.h3,{id:"\u7f16\u5199-docker-conpose-\u6587\u4ef6",children:"\u7f16\u5199 docker-conpose \u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u4e00\u822c\u5b89\u88c5\u4e86 docker \u90fd\u4f1a\u5b89\u88c5 docker-compose\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"docker-compose -verison"})," \u67e5\u770b\u662f\u5426\u5b89\u88c5"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"\u279c  ~ docker-compose -verison\ndocker-compose version 1.27.4, build 40524192\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\u300cmysqlms\u300d\u7528\u4e8e\u5b58\u653e\u672c\u6b21\u642d\u5efa\u7684\u6587\u4ef6\n\u5728 \u300cmysqlms\u300d \u6587\u4ef6\u5939\u65b0\u5efa dokcer-compose \u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u4e3a \u300cdocker-compose.yaml\u300d"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"version: '2' \nnetworks:\n  byfn:                                       #\u914d\u7f6ebyfn\u7f51\u7edc\nservices:\n  master:                                     #\u914d\u7f6emaster\u670d\u52a1\n    image: 'mysql:latest'                        #\u4f7f\u7528\u521a\u624dpull\u4e0b\u6765\u7684\u955c\u50cf\n    restart: on-failure\n    container_name: mysql-master              #\u5bb9\u5668\u8d77\u540d mysql-master\n    environment:\n      MYSQL_USER: test\n      MYSQL_PASSWORD: admin123\n      MYSQL_ROOT_PASSWORD: admin123           #\u914d\u7f6eroot\u7684\u5bc6\u7801\n    ports:\n      - '3316:3306'                           #\u914d\u7f6e\u7aef\u53e3\u6620\u5c04\n    volumes:\n      - \"./master/my.cnf:/etc/mysql/my.cnf\"   #\u914d\u7f6emy.cnf\u6587\u4ef6\u6302\u8f7d\uff0c\n      - \"./master/mysql-files:/var/lib/mysql-files\" #MySQL 8.0 \u4e0d\u52a0\u8fd9\u4e00\u884c\u4f1a\u62a5\u9519\n    networks:\n      - byfn                                  #\u914d\u7f6e\u5f53\u524dservie\u6302\u8f7d\u7684\u7f51\u7edc\n  slave:                                      #\u914d\u7f6eslave\u670d\u52a1\n    image: 'mysql:latest'\n    restart: on-failure\n    container_name: mysql-slave\n    environment:\n      MYSQL_USER: test\n      MYSQL_PASSWORD: admin123\n      MYSQL_ROOT_PASSWORD: admin123\n    ports:\n      - '3326:3306'\n    volumes:\n      - \"./slave/my.cnf:/etc/mysql/my.cnf\"\n      - \"./master/mysql-files:/var/lib/mysql-files\" #MySQL 8.0 \u4e0d\u52a0\u8fd9\u4e00\u884c\u4f1a\u62a5\u9519\n    networks:\n      - byfn\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:'- "./master/mysql-files:/var/lib/mysql-files"'})," \u8fd9\u4e00\u884c\u7684\u76ee\u7684\u8be6\u89c1\u4e0b\u9762\u94fe\u63a5"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/docker-library/mysql/issues/541",children:"https://github.com/docker-library/mysql/issues/541"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u5982\u679c\u60f3\u660e\u786e\u6307\u5b9a MySQL \u7248\u672c\uff0c\u5982\uff1a ",(0,l.jsx)(n.code,{children:"image: 'mysql:8'"})]}),"\n",(0,l.jsx)(n.h3,{id:"\u7f16\u5199-cnf-\u6587\u4ef6",children:"\u7f16\u5199 cnf \u6587\u4ef6"}),"\n",(0,l.jsx)(n.p,{children:"\u5728 \u300cmysqlms\u300d\u65b0\u5efa\u4e24\u4e2a\u6587\u4ef6\u5939 \u300cmaster\u300d \u548c \u300cslave\u300d\uff0c\u5728\u5176\u4e2d\u5206\u522b\u5199\u5165\u6587\u4ef6\u300cmy.cnf\u300d"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"mysqlms/master/my.cnf \u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[mysqld]\nserver-id=1\nlog-bin=/var/lib/mysql/mysql-bin\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"mysqlms/slave/my.cnf \u5185\u5bb9\u5982\u4e0b"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[mysqld]\nserver-id=2\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u300cmysqlms\u300d\u76ee\u5f55\u4e0b\u6267\u884c\u5982\u4e0b\u547d\u4ee4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose.yaml up -d\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u65f6\u4e24\u4e2a\u4e3b\u4ece\u6570\u636e\u5e93\u521b\u5efa\u6210\u529f"}),"\n",(0,l.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"master",children:"Master"}),"\n",(0,l.jsx)(n.p,{children:"\u542f\u52a8\u4e4b\u540e\u8fdb\u5165 master \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker exec -it mysql-master /bin/bash\nmysql -uroot -padmin123\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u65f6\u8fdb\u5165\u4e86 MySql \u7ec8\u7aef\uff0c\u521b\u5efa\u7528\u4e8e\u4e3b\u4ece\u590d\u5236\u7684\u7528\u6237"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"create user 'repl'@'%' identified with 'mysql_native_password' by 'admin123';\nGRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'repl'@'%'; \n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u6709\u4e00\u4e2a\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u5e94\u8be5\u662f MySQL 5.0 \u4e0e MySQL 8.0 \u7684\u4e00\u4e2a\u9a8c\u8bc1\u8eab\u4efd\u7684\u6bd4\u8f83\u5927\u7684\u533a\u522b\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"MySql 8.0 \u9ed8\u8ba4\u6307\u5b9a\u4f7f\u7528\u9700\u8981 SSL \u7684\u8eab\u4efd\u9a8c\u8bc1\u63d2\u4ef6 \u300ccaching_sha2_password\u300d\uff0c\u610f\u5473\u7740\u6211\u4eec\u4ece\u5e93\u5fc5\u987b\u4f7f\u7528\u5b89\u5168\u94fe\u63a5\u6765\u8fde\u63a5\u5230\u4e3b\u5e93\u624d\u53ef\u4ee5\uff0c\u5426\u5219\u4ece\u5e93\u94fe\u63a5\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff0c\u9519\u8bef\u4ee3\u7801\u4e3a 2061\uff0c\u56e0\u6b64\u8fd9\u91cc\u9009\u62e9\u7ed5\u8fc7\u8fd9\u4e2a\u63d2\u4ef6\uff0c\u6539\u4e3a\u4f7f\u7528\u300cmysql_native_password\u300d\u6765\u9a8c\u8bc1\u3002\u6709\u673a\u4f1a\u53ef\u4ee5\u5c1d\u8bd5\u4ee5\u4e0b\u4f7f\u7528\u5b89\u5168\u8fde\u63a5\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"flush privileges;\nshow master status;\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mysql> show master status;\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000003 |      767 |              |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.00 sec)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9700\u8981\u8bb0\u4f4f File \u540d\u5b57\uff0c\u548c Position \u504f\u79fb\u4f4d\u7f6e"}),"\n",(0,l.jsx)(n.h3,{id:"slave",children:"Slave"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\u8fdb\u5165 slave  \u5bb9\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker exec -it mysql-slave /bin/bash\nmysql -uroot -padmin123\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fdb\u5165 MySQL \u7ec8\u7aef\u4e4b\u540e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mysql> CHANGE MASTER TO MASTER_HOST='mysql-master', MASTER_PORT=3306,  MASTER_USER='repl', MASTER_PASSWORD='admin123', MASTER_LOG_FILE='mysql-bin.000003', MASTER_LOG_POS=767;\nmysql> start slave;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u8fd9\u91cc\u4e24\u4e2a\u53c2\u6570 ",(0,l.jsx)(n.code,{children:"MASTER_LOG_FILE"})," \u548c ",(0,l.jsx)(n.code,{children:"MASTER_LOG_POS"})," \u5c31\u662f\u524d\u9762 master \u4e0a\u6700\u540e\u67e5\u8be2\u51fa\u6765\u7684"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mysql> show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: mysql-master\n                  Master_User: repl\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: mysql-bin.000003\n          Read_Master_Log_Pos: 1116\n               Relay_Log_File: eefecaed2964-relay-bin.000002\n                Relay_Log_Pos: 320\n        Relay_Master_Log_File: mysql-bin.000003\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table\n......\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u4ece\u4e2d\u770b\u5230\u4e00\u4e9b\u4fe1\u606f\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u89c1\u4e3b\u4ece\u914d\u7f6e\u6210\u529f"}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u8003\u94fe\u63a5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/wawa8899/article/details/86689618",children:"https://blog.csdn.net/wawa8899/article/details/86689618"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/replication-howto-repuser.html",children:"https://dev.mysql.com/doc/refman/8.0/en/replication-howto-repuser.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/docker-library/mysql/issues/541",children:"https://github.com/docker-library/mysql/issues/541"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/wangxiaotongfan/article/details/81870258",children:"https://blog.csdn.net/wangxiaotongfan/article/details/81870258"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>a});var l=s(7294);const i={},r=l.createContext(i);function a(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);